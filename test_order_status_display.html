<!DOCTYPE html>
<html>
	<head>
		<title>Test Order Status Display</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
		/>
	</head>
	<body>
		<div class="container mt-5">
			<h2>üß™ Test Order Status v·ªõi Gi√° hi·ªÉn th·ªã</h2>

			<div class="row">
				<div class="col-md-6">
					<h4>Test API Response</h4>
					<button class="btn btn-primary" onclick="testAPI()">
						Test API get_order_status.php
					</button>
					<div id="apiResult" class="mt-3"></div>
				</div>

				<div class="col-md-6">
					<h4>Mock Display Order Status</h4>
					<div id="orderStatusList"></div>
					<button
						class="btn btn-success mt-2"
						onclick="testDisplay()"
					>
						Test Display Function
					</button>
				</div>
			</div>
		</div>

		<script>
			function formatCurrency(amount) {
				return new Intl.NumberFormat('vi-VN').format(amount);
			}

			function testAPI() {
				fetch('/buffet_booking_mvc/get_order_status.php?table=D2')
					.then((response) => response.json())
					.then((data) => {
						document.getElementById('apiResult').innerHTML = `
                    <div class="alert ${
						data.success ? 'alert-success' : 'alert-danger'
					}">
                        <h5>API Response:</h5>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
					})
					.catch((error) => {
						document.getElementById('apiResult').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>Error:</h5>
                        <pre>${error}</pre>
                    </div>
                `;
					});
			}

			function testDisplay() {
				// Mock data for testing display
				const mockOrders = [
					{
						id: 16,
						status: 'completed',
						total: 50000,
						notes: 'CAY',
						created_at: '11/07/2025 13:21',
						items: [
							{ name: 'Sushi c√° h·ªìi', quantity: 1, price: 20000 },
							{ name: 'Tempura t√¥m', quantity: 1, price: 30000 },
						],
					},
					{
						id: 15,
						status: 'completed',
						total: 35000,
						notes: '',
						created_at: '11/07/2025 12:48',
						items: [
							{ name: 'Bia', quantity: 1, price: 15000 },
							{
								name: 'C∆°m chi√™n Nh·∫≠t',
								quantity: 1,
								price: 20000,
							},
						],
					},
				];

				displayOrderStatus(mockOrders);
			}

			function getStatusClass(status) {
				const statusClasses = {
					pending: 'warning',
					preparing: 'info',
					served: 'success',
					completed: 'success',
					cancelled: 'danger',
				};
				return statusClasses[status] || 'secondary';
			}

			function getStatusText(status) {
				const statusTexts = {
					pending: 'Ch·ªù x·ª≠ l√Ω',
					preparing: 'ƒêang chu·∫©n b·ªã',
					served: 'ƒê√£ ph·ª•c v·ª•',
					completed: 'Ho√†n th√†nh',
					cancelled: 'ƒê√£ h·ªßy',
				};
				return statusTexts[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
			}

			function displayOrderStatus(orders) {
				const container = document.getElementById('orderStatusList');
				if (!container) return;

				if (!orders || orders.length === 0) {
					container.innerHTML = `
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h5>
                    <p class="text-muted mb-0">ƒê∆°n h√†ng s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi b·∫°n g·ª≠i ƒë∆°n</p>
                </div>
            `;
					return;
				}

				container.innerHTML = orders
					.map((order) => {
						const statusClass = getStatusClass(order.status);
						const statusText = getStatusText(order.status);
						const isPreparing = order.status === 'preparing';

						return `
                <div class="order-status-item border-bottom pb-3 mb-3 ${
					isPreparing ? 'pulse-animation' : ''
				}">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <h6 class="mb-1">ƒê∆°n h√†ng #${order.id}</h6>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                ${order.created_at}
                            </small>
                        </div>
                        <span class="badge bg-${statusClass}">${statusText}</span>
                    </div>

                    ${
						order.items
							? `
                        <div class="mb-2">
                            <small class="text-muted d-block mb-1">M√≥n ƒë√£ g·ªçi:</small>
                            <ul class="order-items-list mb-0 list-unstyled">
                                ${order.items
									.map(
										(item) => `
                                    <li class="d-flex justify-content-between">
                                        <span><span class="fw-bold">${
											item.quantity
										}x</span> ${item.name}</span>
                                        <span class="text-primary">${formatCurrency(
											item.price
										)} ‚Ç´</span>
                                    </li>
                                `
									)
									.join('')}
                            </ul>
                        </div>
                    `
							: ''
					}

                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            ${
								order.notes
									? `
                                <i class="fas fa-sticky-note me-1"></i>
                                Ghi ch√∫: ${order.notes}
                            `
									: ''
							}
                        </small>
                        <div class="fw-bold text-end">
                            T·ªïng: <span class="text-success">${formatCurrency(
								order.total
							)} ‚Ç´</span>
                        </div>
                    </div>
                </div>
            `;
					})
					.join('');
			}
		</script>

		<style>
			.order-status-item {
				background: white;
				padding: 15px;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				margin-bottom: 15px;
			}

			.order-items-list li {
				padding: 2px 0;
				font-size: 0.9rem;
			}

			.pulse-animation {
				animation: pulse 2s infinite;
			}

			@keyframes pulse {
				0% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.02);
				}
				100% {
					transform: scale(1);
				}
			}
		</style>
	</body>
</html>
