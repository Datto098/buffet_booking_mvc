<!DOCTYPE html>
<html>
	<head>
		<title>Test Promotion Edit with Authentication</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
			}
			.section {
				margin: 20px 0;
				padding: 15px;
				border: 1px solid #ddd;
				border-radius: 5px;
			}
			.success {
				background-color: #d4edda;
				border-color: #c3e6cb;
			}
			.error {
				background-color: #f8d7da;
				border-color: #f5c6cb;
			}
			.info {
				background-color: #d1ecf1;
				border-color: #bee5eb;
			}
			pre {
				background: #f8f9fa;
				padding: 10px;
				border-radius: 4px;
				overflow-x: auto;
			}
			button {
				padding: 10px 20px;
				margin: 5px;
				background: #007bff;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}
			button:hover {
				background: #0056b3;
			}
			input[type='text'],
			input[type='password'] {
				padding: 8px;
				margin: 5px;
				width: 200px;
			}
		</style>
	</head>
	<body>
		<h1>Test Promotion Edit API with Authentication</h1>

		<div class="section info">
			<h2>Step 1: Login</h2>
			<form id="loginForm">
				<label
					>Email:
					<input
						type="text"
						id="email"
						value="admin@admin.com" /></label
				><br />
				<label
					>Password:
					<input
						type="password"
						id="password"
						value="admin123" /></label
				><br />
				<button type="submit">Login</button>
			</form>
			<div id="loginResult"></div>
		</div>

		<div class="section">
			<h2>Step 2: Test Promotions List</h2>
			<button onclick="testPromotionsList()">Test Promotions List</button>
			<div id="promotionsListResult"></div>
		</div>

		<div class="section">
			<h2>Step 3: Test Get Promotion API</h2>
			<label
				>Promotion ID: <input type="text" id="promotionId" value="1"
			/></label>
			<button onclick="testGetPromotion()">Test Get Promotion</button>
			<div id="getPromotionResult"></div>
		</div>

		<div class="section">
			<h2>Step 4: Test Edit Promotion Form</h2>
			<button onclick="testEditForm()">Open Edit Form</button>
			<div id="editFormResult"></div>
		</div>

		<script>
			const SITE_URL = 'http://localhost/buffet_booking_mvc';

			// Login form handler
			document
				.getElementById('loginForm')
				.addEventListener('submit', async function (e) {
					e.preventDefault();

					const email = document.getElementById('email').value;
					const password = document.getElementById('password').value;

					try {
						const response = await fetch(`${SITE_URL}/auth/login`, {
							method: 'POST',
							headers: {
								'Content-Type':
									'application/x-www-form-urlencoded',
							},
							body: `email=${encodeURIComponent(
								email
							)}&password=${encodeURIComponent(password)}`,
							credentials: 'include',
						});

						const result = await response.text();
						document.getElementById('loginResult').innerHTML = `
                    <h4>Login Response (Status: ${response.status}):</h4>
                    <pre>${result}</pre>
                `;

						if (response.ok || response.status === 302) {
							document.getElementById('loginResult').className =
								'success';
							document.getElementById('loginResult').innerHTML +=
								'<p>✅ Login appears successful!</p>';
						} else {
							document.getElementById('loginResult').className =
								'error';
						}
					} catch (error) {
						document.getElementById('loginResult').innerHTML = `
                    <h4>Login Error:</h4>
                    <pre>${error.message}</pre>
                `;
						document.getElementById('loginResult').className =
							'error';
					}
				});

			// Test promotions list
			async function testPromotionsList() {
				try {
					const response = await fetch(
						`${SITE_URL}/superadmin/promotions`,
						{
							credentials: 'include',
						}
					);

					const result = await response.text();
					document.getElementById(
						'promotionsListResult'
					).innerHTML = `
                    <h4>Promotions List Response (Status: ${
						response.status
					}):</h4>
                    <pre>${result.substring(0, 500)}...</pre>
                `;

					if (response.ok) {
						document.getElementById(
							'promotionsListResult'
						).className = 'success';
						document.getElementById(
							'promotionsListResult'
						).innerHTML += '<p>✅ Promotions page loaded!</p>';
					} else {
						document.getElementById(
							'promotionsListResult'
						).className = 'error';
					}
				} catch (error) {
					document.getElementById(
						'promotionsListResult'
					).innerHTML = `
                    <h4>Error:</h4>
                    <pre>${error.message}</pre>
                `;
					document.getElementById('promotionsListResult').className =
						'error';
				}
			}

			// Test get promotion API
			async function testGetPromotion() {
				const promotionId =
					document.getElementById('promotionId').value;

				try {
					const response = await fetch(
						`${SITE_URL}/superadmin/promotions/get/${promotionId}`,
						{
							credentials: 'include',
							headers: {
								Accept: 'application/json',
							},
						}
					);

					const result = await response.text();
					document.getElementById('getPromotionResult').innerHTML = `
                    <h4>Get Promotion Response (Status: ${response.status}):</h4>
                    <pre>${result}</pre>
                `;

					if (response.ok) {
						document.getElementById(
							'getPromotionResult'
						).className = 'success';

						try {
							const jsonData = JSON.parse(result);
							document.getElementById(
								'getPromotionResult'
							).innerHTML += `
                            <h4>✅ Parsed JSON:</h4>
                            <pre>${JSON.stringify(jsonData, null, 2)}</pre>
                        `;
						} catch (e) {
							document.getElementById(
								'getPromotionResult'
							).innerHTML += '<p>⚠️ Response is not JSON</p>';
						}
					} else {
						document.getElementById(
							'getPromotionResult'
						).className = 'error';
					}
				} catch (error) {
					document.getElementById('getPromotionResult').innerHTML = `
                    <h4>Error:</h4>
                    <pre>${error.message}</pre>
                `;
					document.getElementById('getPromotionResult').className =
						'error';
				}
			}

			// Test edit form functionality
			async function testEditForm() {
				const promotionId =
					document.getElementById('promotionId').value;

				document.getElementById('editFormResult').innerHTML = `
                <h4>Simulating Edit Form:</h4>
                <div id="editFormTest">
                    <p>This simulates clicking the edit button for promotion ${promotionId}</p>
                    <button onclick="simulateEditClick(${promotionId})">Simulate Edit Click</button>
                </div>
            `;
			}

			// Simulate the edit promotion click
			async function simulateEditClick(promotionId) {
				try {
					const response = await fetch(
						`${SITE_URL}/superadmin/promotions/get/${promotionId}`,
						{
							credentials: 'include',
							headers: {
								Accept: 'application/json',
							},
						}
					);

					const data = await response.json();

					if (data.success) {
						document.getElementById('editFormTest').innerHTML += `
                        <div class="success">
                            <h5>✅ Edit data loaded successfully!</h5>
                            <p><strong>Promotion:</strong> ${
								data.promotion.name
							}</p>
                            <p><strong>Code:</strong> ${data.promotion.code}</p>
                            <p><strong>Application Type:</strong> ${
								data.promotion.application_type || 'all'
							}</p>
                            <p><strong>Food Items:</strong> ${
								data.promotion.food_items.length
							} items</p>
                            <p><strong>Categories:</strong> ${
								data.promotion.categories.length
							} categories</p>
                            <h6>Full Data:</h6>
                            <pre>${JSON.stringify(
								data.promotion,
								null,
								2
							)}</pre>
                        </div>
                    `;
					} else {
						document.getElementById('editFormTest').innerHTML += `
                        <div class="error">
                            <h5>❌ Failed to load edit data</h5>
                            <p>Error: ${data.message}</p>
                        </div>
                    `;
					}
				} catch (error) {
					document.getElementById('editFormTest').innerHTML += `
                    <div class="error">
                        <h5>❌ Error:</h5>
                        <p>${error.message}</p>
                    </div>
                `;
				}
			}
		</script>
	</body>
</html>
